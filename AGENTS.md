# KaiGen Contributor Guide

## Architectural Map
- `kaigen.php`: WordPress plugin bootstrap that registers hooks and enqueues the built assets.
- `assets/`: Static plugin assets (images, styles) referenced from PHP templates.
- `build/`: Transpiled production bundles generated by `wp-scripts build`.
- `src/`: Source JavaScript for the Gutenberg integration.
  - `index.js`: Front-end entry that wires up block filters and shared logic.
  - `admin.js`: Admin-only entry point for the plugin settings experience.
  - `api.js`: Helper utilities for talking to the Kai image-generation endpoints.
  - `components/`: React components that make up the UI (e.g., `AIImageToolbar`, `AITab`).
  - `filters/`: Block editor filters registered with WordPress (`addBlockEditFilter`, `registerFormatType`, etc.).
- `inc/`: PHP helpers that support REST routes, settings, and image handling.
- `tests/`: Automated test suites.
  - `e2e/`: Playwright specs exercising the plugin in WordPress Playground.
  - `http-mock.php`: Local server mock used inside the Playwright suite.
- `playwright/` & `playwright.config.ts`: Shared Playwright fixtures and configuration for the E2E environment.
- `.github/blueprints/`: WordPress Playground blueprints used to boot environments for tests and previews.
- `.github/workflows/`: CI definitions for builds, deploys, and Playwright-based E2E tests.

## Testing Expectations
- **Always run the relevant tests after each major code iteration.** When a test fails, first decide whether the code or the test is incorrect. Fix the implementation when the failure highlights a regression; update or extend the test only when the expected behaviour truly changed.
- **Add coverage whenever you build new behaviour.** If no automated test exists for the feature you touched, create one (E2E, unit, or integration) before shipping.

## E2E Test Workflow
Mirror the GitHub Actions job defined in `.github/workflows/playwright.yml` when running end-to-end tests locally:
1. Install dependencies with `npm ci` from the repository root.
2. Cache or install the required Playwright browsers: `npx playwright install chromium --with-deps`.
3. Start the WordPress Playground server the same way CI does:
   ```bash
   npx @wp-playground/cli server \
     --mount=.:/wordpress/wp-content/plugins/kaigen \
     --blueprint=.github/blueprints/e2e-test.json \
     --port=9400
   ```
   Wait until the server responds before launching tests (CI uses `npx wait-on -t 60000 http://localhost:9400`).
4. In another terminal, execute the Playwright suite via `npm run test:playground` (alias for `playwright test`).
5. When debugging, feel free to use the helper scripts defined in `package.json` (`test:e2e:ui`, `test:e2e:debug`, etc.).
6. Stop the Playground server when you are done.

## Unit Test & Lint Workflow
While there is no dedicated CI job yet, follow the same setup steps used across the workflows: checkout the repository, run `npm ci`, and execute the relevant WordPress Scripts commands.
- Add or update unit tests using `@wordpress/scripts`. Expose them through an npm script (e.g., `wp-scripts test-unit-js`) and ensure they run cleanly with `npm run test:unit`.
- Keep JavaScript linting healthy by running `npm run lint:js` (and `npm run lint:css` when styles change).
- Whenever you introduce new logic, either extend the unit tests or create new ones alongside it. Treat lint failures as blockersâ€”fix the code unless the lint rule is no longer valid.

## Additional Expectations
- Update documentation (`README.md`, user docs) whenever behaviour changes in a way users would notice.
- Keep the `build/` output in sync when you touch source files that ship to production. Use `npm run build` before committing changes that affect compiled assets.
